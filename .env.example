# ============================================================
# REQUIRED: app controls/secrets without which the app will fail
# ============================================================

# Postgres bootstrap + shared DB connection
POSTGRES_USER=sentinel
POSTGRES_PASSWORD=sentinel
POSTGRES_DB=sentinel
DATABASE_URL=postgresql://sentinel:sentinel@postgres:5432/sentinel

# NextAuth (web)
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=replace-with-a-strong-random-secret

# Entra app registration (shared for web + worker)
ENTRA_TENANT_ID=
ENTRA_CLIENT_ID=
ENTRA_CLIENT_SECRET=

# Internal worker API URL (web -> worker)
WORKER_API_URL=http://worker:5000
WORKER_INTERNAL_API_TOKEN=replace-with-a-strong-random-token
WORKER_HEARTBEAT_TOKEN=replace-with-a-strong-random-token

# Group-based access control
ADMIN_GROUP_ID=
USER_GROUP_ID=


# ============================================================
# OPTIONAL: non-compulsory overrides (defaults are in code)
# ============================================================

# DB connection + write-retry tuning
DB_CONNECT_TIMEOUT_SECONDS=10
DB_WRITE_MAX_RETRIES=6
DB_WRITE_RETRY_BASE_MS=200
DB_WRITE_RETRY_MAX_MS=3000
DB_WRITE_RETRY_JITTER_MS=150

# Internal email domains (comma-separated) for sharing classification
INTERNAL_EMAIL_DOMAINS=princeton.edu

# Dashboard tuning
DASHBOARD_DORMANT_LOOKBACK_DAYS=90
DASHBOARD_RISK_SCAN_LIMIT=500

# Scheduler
SCHEDULER_POLL_SECONDS=30
RECOVER_INTERRUPTED_RUNS_ON_STARTUP=true

# Worker heartbeat (worker -> web)
WORKER_HEARTBEAT_URL=http://web:3000/api/internal/worker-heartbeat
WORKER_HEARTBEAT_INTERVAL_SECONDS=30
WORKER_HEARTBEAT_TIMEOUT_SECONDS=5
WORKER_HEARTBEAT_FAIL_THRESHOLD=2

# Graph ingestion tuning
GRAPH_BASE=https://graph.microsoft.com/v1.0
GRAPH_MAX_CONCURRENCY=4
GRAPH_MAX_RETRIES=5
GRAPH_CONNECT_TIMEOUT=10
GRAPH_READ_TIMEOUT=60
GRAPH_PAGE_SIZE=200
GRAPH_PERMISSIONS_BATCH_SIZE=50
GRAPH_PERMISSIONS_STALE_AFTER_HOURS=24

# Worker ingestion batching
FLUSH_EVERY=500

# Graph Sync job behavior (env-only runtime config)
GRAPH_SYNC_PULL_PERMISSIONS=true
GRAPH_SYNC_GROUP_MEMBERSHIPS=true
GRAPH_SYNC_GROUP_MEMBERSHIPS_USERS_ONLY=true
# Comma-separated stage list; leave empty for default full pipeline
GRAPH_SYNC_STAGES=
# Comma-separated stage exclusions
GRAPH_SYNC_SKIP_STAGES=
